{
    "version": "1.0",
    "license": "CC BY-NC-SA 4.0",
    "title": "数据库登录程序示例 Simple",
    "author": {"Xbodw" : ["https://space.bilibili.com/1552375363","https://github.com/Xbodw"]},
    "description": "",
    "tags": [
        "nothing",
        "404"
    ],
    "thumbnail": "https://i.snipboard.io/g7qR4.jpg",
    "content": "​\n\n 最近看见好多人都在写这个，但他们用的都是用户名登录，如果用户名太长，那就太麻烦了。\n\n第一步：按照网上的教程建表。并在表中手动输入一条数据。\n\n![](https://i-blog.csdnimg.cn/blog_migrate/a736e192529acf83ad7684ac48cf8e57.png)![](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)​编辑\n\n第二步：在Form1.cs（登录界面）自定义一个判断密码用户名是否正确的方法:\n\n```\npublic int Ex(string sql)\n        {\n            SqlCommand com = new SqlCommand(sql, conn);\n            if (conn.State == ConnectionState.Closed)\n                conn.Open();\n            com.CommandType = CommandType.Text;\n            int result = Convert.ToInt32(com.ExecuteScalar());\n            conn.Close();\n            return result;\n        }\n```\n\n![](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)  \n\n再定义一个GetDataSet方法，用于查询用户名。\n\n```\npublic static DataSet GetDataSet(string sql1)\n        {\n            SqlDataAdapter sqlda = new SqlDataAdapter(sql1,conn);\n            DataSet ds = new DataSet();\n             sqlda.Fill(ds);\n            return ds;\n        }\n```\n\n![](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)  \n\nID输入框的代码如下\n\n```\nprivate void textBox1_KeyPress(object sender, KeyPressEventArgs e)\n        {\n            if (char.IsDigit(e.KeyChar) || (e.KeyChar == '\\r' || (e.KeyChar == '\\b')))\n                e.Handled = false;\n            else\n                e.Handled = true;\n        }\n```\n\n![](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)  \n\n判断输入是否合理方法代码如下：\n\n```\nprivate bool ValidateInput()\n        {\n            if (textBox1.Text.Trim() == \"\")\n            {\n                MessageBox.Show(\"请输入登录账号\");\n            }\n            else if (int.Parse(textBox1.Text.Trim()) > 65535)\n                MessageBox.Show(\"请输入正确的登录账号\");\n            else if (textBox1.Text.Trim().Length > 5 && textBox2.Text.Trim() == \"\")\n                MessageBox.Show(\"请输入密码\");\n            return true;\n        }\n```\n\n![](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)  \n\n登录按钮事件代码如下：\n\n```\nif (ValidateInput())\n            {\n                try\n                {\n                    if(conn.State == ConnectionState.Open)\n                    {\n                        conn.Dispose();\n                        conn.Close();\n                    }\n                    int id = int.Parse(textBox1.Text.Trim());\n                    string sql = \"select count(*) from tb_User where ID=\" + id + \" and Pwd = '\" + textBox2.Text + \"'\";\n                    int num = Ex(sql);\n                    if (num == 1)\n                    {\n                        UserID = int.Parse(textBox1.Text.Trim());\n                        this.Hide();\n                        Form2 Form21 = new Form2();\n                        Form21.Show();\n                    }\n                    else\n                    {\n                        MessageBox.Show(\"用户Id或密码不正确\");\n                    }\n                }\n                catch(Exception ex)\n                {\n                    MessageBox.Show(\"未能连接到服务器\",\"提示\");\n                }\n            }\n```\n\n![](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)  \n\n别忘了在\n\npublic Form1()\n\n        {\n\n            InitializeComponent();\n\n        }\n\n的下面添加\n\n```\npublic static int UserID = 0;\n        public static SqlConnection conn = new SqlConnection(@\"Data Source=DESKTOP-GNQACEJ\\Gres;Integrated Security=True;DataBase=Server\");\n```\n\n![](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)  \n\n新建一个主窗体，在主窗体中写入代码:\n\n```\npublic static string PeopleName;\n        private void Form2_Load(object sender, EventArgs e)\n        {\n            PeopleName = Form1.GetDataSet(\"select Name from tb_User where ID=\" + Form1.UserID).Tables[0].Rows[0][0].ToString();\n            label1.Text = PeopleName + \"\\n(\" + Form1.UserID + \")\";\n            label2.Text = Form1.GetDataSet(\"select Text from tb_User where ID=\" + Form1.UserID).Tables[0].Rows[0][0].ToString();\n            if(label1.Text.Trim().Length < 1)\n            {\n                label2.Text = \"无个性签名\";\n            }\n        }\n```\n\n![](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)  \n\n程序最终运行效果：Form1\n\n![](https://i-blog.csdnimg.cn/blog_migrate/79f9d7afaf4e36d5d644b863ee1cfaad.png)![](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)​编辑\n\n Form2\n\n![](https://i-blog.csdnimg.cn/blog_migrate/473b87e706d7c896d3512853bf5cd2ec.png)![](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)​编辑\n\n​"
}